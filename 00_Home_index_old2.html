<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <!-- Google Fonnts -->
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:ital,wght@0,200;0,400;0,600;0,700;1,200;1,700&family=Cabin+Condensed:wght@400;500;600;700&family=Contrail+One&display=swap" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">

        
        <!-- CSS Stylesheets -->
        <link href="css/bootstrap.min.css" rel="stylesheet">
        <link href="css/bootstrap-icons.css" rel="stylesheet">
        <link href="css/vegas.min.css" rel="stylesheet">
        <link href="css/tooplate-barista.css" rel="stylesheet">
        <link href="css/aboutus_style.css" rel="stylesheet">
        <link rel="stylesheet" href="css/main-styles.css">
        <link rel="stylesheet" href="css/jet-title-styles.css">
        <link rel="stylesheet" href="css/arrow_style.css">
        <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
        <!-- d3-simple-slider CSS -->
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/d3-simple-slider@1.7.4/dist/d3-simple-slider.min.css" />
        <!-- d3-simple-slider JS -->
        <script src="https://cdn.jsdelivr.net/npm/d3-simple-slider@1.7.4/dist/d3-simple-slider.min.js"></script>

        
        
        <!-- Page-specific Custom Style -->
        <style>
            /* ===============================
            CHART + MAP AREA
            ================================= */
            .chart {
                width: 100%;
                height: 90vh;
                display: grid;
                grid-template-rows: 10% 80%;
                background-color: #f4f4f4;
                position: sticky;
                top: 0;
            }

            #map {
                width: 100%;
                height: 80vh;
                position: relative;
                overflow: visible;
            }

            #chartArea {
                display: grid;
                grid-template-columns: 70% 25%;
                height: 100vh;
                overflow-y: auto;
                overflow-x: hidden;
                width: 100%;
                background-color: #f4f4f4;
                color: #333;
            }

            #container1 {
                height: 100%;
                width: 100%;
                overflow: hidden;
            }

            #slider {
            margin-top: 40px;
            width: 500px;
            height: 80px;
            }

            

            /* ===============================
            MAP ELEMENTS
            ================================= */
            .maptitle {
                font-size: 30px;
                text-align: center;
                font-weight: bold;
                color: black;
                margin-top: 2%;
            }

            g line {
                stroke: lightgray;
            }

            .country {
                stroke: white;
                stroke-width: 0.5px;
                cursor: pointer;
                vector-effect: non-scaling-stroke;
                fill-opacity: 1;
                shape-rendering: geometricPrecision;
            }

            .country:hover {
                stroke-width: 2px;
                stroke: black;
                z-index: 1000;
                position: relative;
            }

            .europe {
                fill: #4682B4;
            }

            circle.europe {
                stroke: #4682B4;
                stroke-width: 1px;
            }

            .europe-label,
            .europe-scatter-label {
                font-size: 18px !important;
                font-weight: bold !important;
                fill: #333 !important;
                text-anchor: middle !important;
                background-color: rgba(255, 255, 255, 0.7);
                padding: 5px;
            }

            /* ===============================
            AXIS + LABELS
            ================================= */
            .x-axis text,
            .y-axis text {
                font-size: 12px;
                fill: #333;
            }

            .x-axis path, .y-axis path,
            .x-axis line, .y-axis line {
                stroke: #333;
            }

            .x-label, .y-label {
                font-size: 14px !important;
                font-weight: bold !important;
                fill: #333 !important;
            }

            .grid-line {
                stroke: #eee;
                shape-rendering: crispEdges;
            }

            /* Ensure data points are always above grid lines */
            .datapoint, .country, circle {
                z-index: 10;
                position: relative;
            }

            /* ===============================
            TOOLTIP
            ================================= */
            .custom-tooltip {
                position: absolute;
                padding: 10px;
                background-color: white;
                border: 1px solid #666;
                border-radius: 5px;
                pointer-events: none;
                opacity: 0;
                z-index: 1000;
                box-shadow: 0 0 10px rgba(0,0,0,0.3);
                font-size: 14px;
                max-width: 200px;
                color: #333;
                line-height: 1.4;
            }

            .custom-tooltip h4 {
                margin: 0 0 8px 0;
                border-bottom: 1px solid #ddd;
                padding-bottom: 5px;
                font-size: 16px;
                color: #4682B4;
            }

            .custom-tooltip p {
                margin: 4px 0;
            }

            .custom-tooltip .data-value {
                font-weight: bold;
            }

            /* ===============================
            TITLE OVERLAY
            ================================= */
            .title-container {
                position: absolute;
                top: 10px;
                left: 0;
                right: 0;
                text-align: center;
                z-index: 100;
                pointer-events: none;
            }

            .title-background {
                background-color: rgba(255, 255, 255, 0.7);
                padding: 8px 15px;
                border-radius: 5px;
                display: inline-block;
            }


            
            /* ===============================
            INTRO SECTION
            ================================= */
            .intro-section {
                padding: 40px 0;
                background-color: #1A2A43;
                color: #fff;
            }

            .intro-container {
                max-width: 1200px;
                margin: 0 auto;
                padding: 0 20px;
                display: flex;
                flex-wrap: wrap;
            }

            .intro-title {
                width: 100%;
                margin-bottom: 30px;
            }

            .intro-title h1 {
                font-size: 3rem;
                text-align: left;
                font-weight: bold;
                margin: 0;
            }

            .intro-content {
                display: flex;
                flex-wrap: wrap;
                gap: 30px;
            }

            .intro-text {
                flex: 1;
                min-width: 300px;
            }

            .intro-text h3 {
                margin-top: 0;
                margin-bottom: 15px;
                font-size: 1.5rem;
            }

            .intro-text ul {
                list-style-type: disc;
                padding-left: 20px;
                margin-bottom: 25px;
            }

            .intro-text li {
                margin-bottom: 8px;
                line-height: 1.5;
            }

            .intro-image {
                flex: 1;
                min-width: 300px;
                max-width: 500px;
                overflow: hidden;
                border-radius: 10px;
                box-shadow: 0 10px 20px rgba(0,0,0,0.3);
            }

            .intro-image img {
                width: 100%;
                height: auto;
                display: block;
                object-fit: cover;
            }

            /* ===============================
            RIGHT SIDE PANEL
            ================================= */
            .right-side-div {
                height: auto;
                margin-left: 10px;
                margin-bottom: 20px;
            }

            .right-side-header {
                background-color: #314563;
                margin-bottom: 10px;
                color: #fff;
                font-size: 15px;
                padding: 5px;
            }

            .right-text {
                background-color: #f1f1f1;
                border-left: 2px solid gray;
                padding: 10px;
                line-height: 1.5;
                color: #333;
            }

            /* ===============================
            RESPONSIVE ADJUSTMENTS
            ================================= */
            @media (max-width: 992px) {
                .intro-content {
                    flex-direction: column;
                }
                
                .intro-image {
                    max-width: 100%;
                    margin-bottom: 20px;
                }
                
                #chartArea {
                    grid-template-columns: 1fr;
                    grid-template-rows: auto auto;
                }
            }

            

            .jet-title {
                font-family: 'Montserrat', sans-serif;
                font-weight: 700;
                font-size: 3.5rem;
                color: white;
            }

            .hero-section h2 {
                font-family: 'Montserrat', sans-serif;
                font-weight: 400;
                font-size: 1.6rem;
                color: #e0e0e0;
            }

            body {
                scroll-padding-top: 70px;
            }



        /* ===============================
        OVERVIEW SECTION
        ================================= */
            .background-video {
                position: absolute;
                top: 0; left: 0;
                width: 100%;
                height: 100%;
                object-fit: cover;
                z-index: 0;
            }       

            .overlay {
                position: absolute;
                top: 0; left: 0; right: 0; bottom: 0;
                background-color: rgba(0, 0, 0, 0.6);
                z-index: 1;
            }    
        
        
            .overview-section {
                position: flex;
                /* background-image: url('videos/videoplayback.webm'); */
                flex-wrap: wrap;
                background-size: cover;
                background-position: center;
                gap: 40px;
                width: 100%;
                height: 100vh;
                align-items: flex-start;
                padding: 40px 20px;
                overflow: hidden;
                color: white;
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .overview-container {
                position: relative;
                z-index: 2;
                display: flex;
                width: 90%;
                max-width: 1400px;
                gap: 40px;
                justify-content: space-between;
                align-items: center;
                flex-wrap: wrap;
            }

            .overview-left {
                flex: 1;
                min-width: 800px;
                height: 500px;
                display: flex;
                align-items: center;
                justify-content: center;
            }

            #pie-chart {
                width: 100%;
                height: 100%;
            }

            .overview-right {
                flex: 1;
                min-width: 300px;
            }

            .overview-right h1 {
                font-size: 2.2rem;
                font-weight: 700;
                margin-bottom: 20px;
                font-family: 'Montserrat', sans-serif;
            }

            .overview-right p {
                font-size: 1.1rem;
                line-height: 1.7;
                max-width: 600px;
            }

            @media (max-width: 768px) {
                .overview-container {
                    flex-direction: column;
                    align-items: flex-start;
            }

            .overview-left, .overview-right {
                    width: 100%;
                }
            }


            .scroll-down {
                display: inline-block;
                margin-top: 40px;
                font-size: 1.2rem;
                color: #ccc;
                text-decoration: none;
                transition: opacity 0.3s ease;
            }

            .scroll-down:hover {
                opacity: 0.7;
            }



        </style>
    </head>








    <body>
        <main>
            <!-- Header Section with Title & Logo and Menu -->
            <div class="header-container"> 
                <!-- Fixed header menu showing current section -->
                <div class="fixed-header-menu">
                    <div class="title-logo">
                        <h3>CASA Group7</h3>
                    </div>
                </div>
                
                <nav class="top-navbar">
                    <div class="navbar-container">
                        <!-- Logo + Title -->
                        <div class="navbar-logo">
                            <img src="images/logo.svg" alt="Logo" class="logo-image">
                            <span class="logo-text">AVIATION NETWORK</span>
                        </div>
                    
                        <!-- Menu -->
                        <ul class="navbar-menu">
                            <li><a href="#Home">Home</a></li>
                            <li><a href="#Introduction">Introduction</a></li>
                            <li><a href="#Global">Global</a></li>
                            <li><a href="#Europe">Europe</a></li>
                            <li><a href="#WorldCup">World Cup</a></li>
                            <li><a href="#Individual">Individual</a></li>
                            <li><a href="#Team">Team</a></li>
                            <li><a href="#references">References</a></li>
                        </ul>
                    </div>
                  </nav>
                  
            </div>

            <!-- Scrollbar indicator for scroll pages -->
            <div class="scrollbar-indicator">
                <ul>
                    <li data-target="#Home" class="active"></li>
                    <li data-target="#Introduction"></li>
                    <li data-target="#Global"></li>
                    <li data-target="#Europe​"></li>
                </ul>
            </div>
            
            <!-- Section transition overlay for smooth transitions -->
            <div class="section-transition-overlay"></div>

            <section class="hero-section d-flex justify-content-center align-items-center" id="Home">
                <div class="container">
                    <div class="row align-items-center justify-content-center text-center">
                        <div class="col-lg-8 col-12">                                
                            <h1 class="jet-title">Jet-Setting Carbon</h1>
                            <h2>The Hidden Link Between Aviation and Climate Change</h2>

                            <div class="flight-path">
                                <span class="flight-dot dot-start"></span>
                                <span class="flight-line"></span>
                                <span class="flight-dot dot-end"></span>
                            </div>

                            <div style="position: absolute; bottom: -200px; left: 0; right: 0; display: flex; justify-content: center; align-items: center; z-index: 10;">
                                <a href="#Introduction" class="section-link smoothscroll" style="display: block; text-align: center;">
                                    <svg id="more-arrows" class="more-arrows" style="filter: drop-shadow(0px 0px 8px rgba(255, 255, 255, 0.7));">
                                        <polygon class="arrow-top" points="37.6,27.9 1.8,1.3 3.3,0 37.6,25.3 71.9,0 73.7,1.3 "/>
                                        <polygon class="arrow-middle" points="37.6,45.8 0.8,18.7 4.4,16.4 37.6,41.2 71.2,16.4 74.5,18.7 "/>
                                        <polygon class="arrow-bottom" points="37.6,64 0,36.1 5.1,32.8 37.6,56.8 70.4,32.8 75.5,36.1 "/>
                                    </svg>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="hero-slides">
                    <video autoplay loop muted playsinline class="hero-video">
                        <source src="videos/private-jet.MOV" type="video/quicktime">
                        <source src="videos/private-jet.MOV" type="video/mp4">
                        Your browser does not support the video tag.
                    </video>
                </div>
            </section>


            <section class="overview-section" id="Overview">
                 <!-- 背景影片 -->
                <video autoplay muted loop playsinline class="background-video">
                    <source src="videos/videoplayback.webm" type="video/webm">
                    Your browser does not support the video tag.
                </video>
                <div class="overlay"></div>
                <div class="overview-container">
    
                    <!-- Left: Interactive Chart Placeholder -->
                    <div class="overview-left">
                      <div id="pie-chart"></div> 
                      <div id="slider" style="margin-top: 30px;"></div>
                    </div>
                
                    <!-- Right: Text Content -->
                    <div class="overview-right">
                      <h1>Air transport is a carbon-intensive luxury.</h1>
                      <p>
                        If flying may seem normal to you, remember that it’s not for everyone.
                        In fact, <strong>1% of the world’s population accounts for 50% of aviation emissions.</strong>
                        Flying, and flying far, is a habit for only a tiny minority of the world’s population.<br><br>
                
                        We often read that aviation is responsible for only 2.5% of greenhouse gas emissions.
                        Today we know that non-CO2 effects account for between 1/2 and 2/3 of radiative forcing,
                        which means that the role of commercial aviation accounts for nearly twice the impact on global warming.
                      </p>
                    </div>
                </div>
            </section>
            




            <!-- 从intro.html添加的Introduction部分 -->
            <section class="intro-section section-padding" id="Introduction" data-aos="fade-up">
                <div class="intro-container">
            
                    <div class="intro-content">
                        <!-- <div class="intro-image">
                            <img src="images/private-jet.jpg" alt="Private Jet">
                        </div> -->
                        
                        <div class="intro-text">
                            <!-- <h3>The Carbon Impact of Private Jets</h3>
                            <ul>
                                <li>Private jets produce significantly more carbon emissions per passenger than commercial flights.</li>
                                <li>The growing popularity of private aviation has led to increased environmental concerns.</li>
                            </ul>
                            
                            <h3>Climate Effects and Global Responsibility</h3>
                            <ul>
                                <li>Despite representing a small portion of flights, private jets contribute disproportionately to aviation emissions.</li>
                                <li>Luxury air travel creates a substantial carbon footprint that impacts global climate goals.</li>
                                <li>Understanding this impact is crucial for developing sustainable aviation policies.</li>
                            </ul> -->
                        </div>
                    </div>
                </div>
            
                <!-- 嵌入iframe，显示intro.html中的可视化部分，但隐藏intro.html中的Introduction部分 -->
                <iframe src="intro.html" style="width:100%; height:800px; border:none; overflow:hidden;" id="vizFrame" scrolling="no"></iframe>
                
                <!-- 添加一个脚本来调整iframe高度并隐藏重复的Introduction -->
                <script>
                    // 给iframe添加加载完成事件
                    document.getElementById('vizFrame').onload = function() {
                        // 确保iframe内容完全加载
                        setTimeout(function() {
                            // 获取iframe内容
                            var iframe = document.getElementById('vizFrame');
                            var iframeDoc = iframe.contentWindow.document;
                            
                            // 隐藏iframe中的Introduction部分
                            var introSection = iframeDoc.querySelector('.intro-section');
                            if (introSection) {
                                introSection.style.display = 'none';
                            }
                            
                            // 调整iframe高度以适应内容
                            iframe.style.height = (iframeDoc.getElementById('chartArea').offsetHeight + 50) + 'px';
                            
                            // 滚动iframe到可视化部分
                            iframe.contentWindow.scrollTo(0, 0);
                        }, 1000);
                    };
                </script>
            </section>


            <section class="barista-section section-padding section-bg" id="Europe​" data-aos="fade-up">
                <div class="container">
                    <div class="row justify-content-center">

                        <div class="col-lg-12 col-12 text-center mb-4 pb-lg-2">
                            <em class="text-white">Creative Baristas</em>

                            <h2 class="text-white">Meet People</h2>
                        </div>

                        <div class="col-lg-3 col-md-6 col-12 mb-4" data-aos="fade-up" data-aos-delay="300">
                            <div class="team-block-wrap">
                                <div class="team-block-info d-flex flex-column">
                                    <div class="d-flex mt-auto mb-3">
                                        <h4 class="text-white mb-0">Steve</h4>

                                        <p class="badge ms-4"><em>Boss</em></p>
                                    </div>

                                    <p class="text-white mb-0">your favourite coffee daily lives tempor.</p>
                                </div>

                                <div class="team-block-image-wrap">
                                    <img src="images/team/portrait-elegant-old-man-wearing-suit.jpg" class="team-block-image img-fluid" alt="">
                                </div>
                            </div>
                        </div>

                        <div class="col-lg-3 col-md-6 col-12 mb-4" data-aos="fade-up" data-aos-delay="400">
                            <div class="team-block-wrap">
                                <div class="team-block-info d-flex flex-column">
                                    <div class="d-flex mt-auto mb-3">
                                        <h4 class="text-white mb-0">Sandra</h4>

                                        <p class="badge ms-4"><em>Manager</em></p>
                                    </div>

                                    <p class="text-white mb-0">your favourite coffee daily lives.</p>
                                </div>

                                <div class="team-block-image-wrap">
                                    <img src="images/team/cute-korean-barista-girl-pouring-coffee-prepare-filter-batch-brew-pour-working-cafe.jpg" class="team-block-image img-fluid" alt="">
                                </div>
                            </div>
                        </div>

                        <div class="col-lg-3 col-md-6 col-12 mb-4" data-aos="fade-up" data-aos-delay="500">
                            <div class="team-block-wrap">
                                <div class="team-block-info d-flex flex-column">
                                    <div class="d-flex mt-auto mb-3">
                                        <h4 class="text-white mb-0">Jackson</h4>

                                        <p class="badge ms-4"><em>Senior</em></p>
                                    </div>

                                    <p class="text-white mb-0">your favourite coffee daily lives.</p>
                                </div>

                                <div class="team-block-image-wrap">
                                    <img src="images/team/small-business-owner-drinking-coffee.jpg" class="team-block-image img-fluid" alt="">
                                </div>
                            </div>
                        </div>

                        <div class="col-lg-3 col-md-6 col-12" data-aos="fade-up" data-aos-delay="600">
                            <div class="team-block-wrap">
                                <div class="team-block-info d-flex flex-column">
                                    <div class="d-flex mt-auto mb-3">
                                        <h4 class="text-white mb-0">Michelle</h4>

                                        <p class="badge ms-4"><em>Barista</em></p>
                                    </div>

                                    <p class="text-white mb-0">your favourite coffee daily consectetur.</p>
                                </div>

                                <div class="team-block-image-wrap">
                                    <img src="images/team/smiley-business-woman-working-cashier.jpg" class="team-block-image img-fluid" alt="">
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </section>
        </main>




        <!-- JAVASCRIPT FILES -->
        <script src="js/jquery.min.js"></script>
        <script src="js/bootstrap.min.js"></script>
        <script src="js/jquery.sticky.js"></script>
        <script src="js/vegas.min.js"></script>
        <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
        <script src="js/custom.js"></script>
    
        <!-- D3可视化相关库 -->
        <script src="https://d3js.org/d3.v7.min.js"></script>
        <script src="https://unpkg.com/d3-tip@0.9.1/dist/index.js"></script>
        <script src="https://unpkg.com/flubber@0.4.2/build/flubber.min.js"></script>
        <script src="https://unpkg.com/topojson@3"></script>
        
        <script>
            document.addEventListener('DOMContentLoaded', function() {
                // AOS初始化
                AOS.init();
                
                // 创建自定义的tooltip处理函数
                window.customTooltip = {
                    show: function(event, d) {
                        const tooltip = d3.select('#custom-tooltip');
                        
                        // 准备显示内容
                        let content = '<h4>' + (d.properties.name || 'Unknown Country') + '</h4>';
                        
                        if (d.properties.carbonFootprint) {
                            content += '<p>Carbon Footprint: <span class="data-value">' + 
                                        d.properties.carbonFootprint.toFixed(2) + ' t/capita</span></p>';
                        } else {
                            content += '<p>Carbon Footprint: <span class="data-value">No data</span></p>';
                        }
                        
                        if (d.properties.gdp) {
                            content += '<p>GDP per capita (log): <span class="data-value">' + 
                                        d.properties.gdp.toFixed(2) + '</span></p>';
                        }
                        
                        if (d.properties.isEuropean) {
                            content += '<p>Region: <span class="data-value">Europe</span></p>';
                        }
                        
                        // 设置内容并显示
                        tooltip.html(content)
                            .style('left', (event.pageX + 10) + 'px')
                            .style('top', (event.pageY - 28) + 'px')
                            .transition()
                            .duration(200)
                            .style('opacity', 1);
                    },
                    
                    move: function(event) {
                        d3.select('#custom-tooltip')
                            .style('left', (event.pageX + 10) + 'px')
                            .style('top', (event.pageY - 28) + 'px');
                    },
                    
                    hide: function() {
                        d3.select('#custom-tooltip')
                            .transition()
                            .duration(500)
                            .style('opacity', 0);
                    }
                };
                
                // 将自定义tooltip添加到window对象，使globalCarbon.js可以访问
                window.myCustomTooltip = window.customTooltip;
                
                // 修改GlobalViz原型中的方法（在原始脚本加载后）
                function patchGlobalViz() {
                    if (typeof GlobalViz === 'function') {
                        // 修改margin设置，增加左侧和右侧的空间
                        const originalInitSvg = GlobalViz.prototype.initSvg;
                        GlobalViz.prototype.initSvg = function() {
                            const result = originalInitSvg.apply(this, arguments);
                            // 修改margin使横轴有更多空间
                            this.margin = { left: 120, right: 60, top: 40, bottom: 60 };
                            this.innerW = this.width - this.margin.left - this.margin.right;
                            this.innerH = this.height - this.margin.top - this.margin.bottom;
                            
                            // 重新定位chart区域
                            this.chartArea.attr("transform", `translate(${this.margin.left}, ${this.margin.top})`);
                            
                            return result;
                        };
                        
                        // 修改坐标轴创建函数，确保网格线在数据点下方
                        const originalAddAxes = GlobalViz.prototype._addAxes;
                        GlobalViz.prototype._addAxes = function() {
                            // 清除已有的坐标轴
                            this.axisG.selectAll("*").remove();
                            
                            // 先添加网格线 - 确保它们在数据点下方
                            // 水平网格线
                            this.axisG.append("g")
                                .attr("class", "grid-lines-horizontal")
                                .selectAll("line")
                                .data(this.yScale.ticks(8))
                                .enter()
                                .append("line")
                                .attr("class", "grid-line")
                                .attr("x1", 0)
                                .attr("x2", this.innerW)
                                .attr("y1", d => this.yScale(d))
                                .attr("y2", d => this.yScale(d))
                                .style("stroke", "#eee")
                                .style("stroke-width", 1);
                            
                            // 垂直网格线
                            this.axisG.append("g")
                                .attr("class", "grid-lines-vertical")
                                .selectAll("line")
                                .data(this.xScale.ticks(8))
                                .enter()
                                .append("line")
                                .attr("class", "grid-line")
                                .attr("x1", d => this.xScale(d))
                                .attr("x2", d => this.xScale(d))
                                .attr("y1", 0)
                                .attr("y2", this.innerH)
                                .style("stroke", "#eee")
                                .style("stroke-width", 1);
                            
                            // X轴 - 修改为更清晰的标签，不显示网格线
                            this.xAxis = this.axisG.append("g")
                                .attr("class", "x-axis")
                                .attr("transform", `translate(0, ${this.innerH})`)
                                .call(d3.axisBottom(this.xScale)
                                .ticks(6)
                                .tickSize(5)  // 只显示短刻度线，不显示网格线
                                .tickPadding(10)
                                .tickFormat(d3.format(".1f")));
                            
                            // Y轴，不显示网格线
                            this.yAxis = this.axisG.append("g")
                                .attr("class", "y-axis")
                                .call(d3.axisLeft(this.yScale)
                                .ticks(8)
                                .tickSize(5)  // 只显示短刻度线，不显示网格线
                                .tickPadding(10)
                                .tickFormat(d3.format(".1f")));
                            
                            // 美化坐标轴
                            this.svg.selectAll(".domain").style("stroke", "#333");
                            this.svg.selectAll(".axis text").style("fill", "#333").style("font-size", "12px");
                            
                            // X轴标签 - 提高可见性
                            this.axisG.append("text")
                                .attr("class", "x-label")
                                .attr("x", this.innerW / 2)
                                .attr("y", this.innerH + 45)
                                .attr("text-anchor", "middle")
                                .attr("font-size", "14px")
                                .attr("font-weight", "bold")
                                .attr("fill", "#333")
                                .text("GDP per capita (log scale)");
                            
                            // Y轴标签 - 提高可见性
                            this.axisG.append("text")
                                .attr("class", "y-label")
                                .attr("transform", "rotate(-90)")
                                .attr("x", -this.innerH / 2)
                                .attr("y", -80)
                                .attr("text-anchor", "middle")
                                .attr("font-size", "14px")
                                .attr("font-weight", "bold")
                                .attr("fill", "#333")
                                .text("Carbon Footprint (t/capita)");
                        };
                        
                        // 修改_executeTransitionToScatterplot方法，确保数据点在网格线上方
                        const originalTransitionToScatterplot = GlobalViz.prototype._executeTransitionToScatterplot;
                        GlobalViz.prototype._executeTransitionToScatterplot = function() {
                            // 先进行坐标轴设置，包括网格线
                            this._addAxes();
                            
                            // 调用原始转换方法
                            const result = originalTransitionToScatterplot.apply(this, arguments);
                            
                            // 确保散点图中的数据点在最顶层
                            this.mapG.selectAll(".datapoint")
                                .raise();  // 将元素提升到其父元素的子元素列表的顶部
                                
                            return result;
                        };
                        
                        // 改进highlightEuropeanCountries方法，确保高亮显示的数据点在最顶层
                        const originalHighlightEuropean = GlobalViz.prototype.highlightEuropeanCountries;
                        if (originalHighlightEuropean) {
                            GlobalViz.prototype.highlightEuropeanCountries = function() {
                                const result = originalHighlightEuropean.apply(this, arguments);
                                
                                // 将欧洲国家的数据点提升到顶层
                                this.mapG.selectAll(".datapoint.europe")
                                    .raise();
                                    
                                return result;
                            };
                        }
                        
                        // 改进drawWorldMap方法，添加自定义tooltip和点击处理
                        const originalDrawWorldMap = GlobalViz.prototype.drawWorldMap;
                        
                        GlobalViz.prototype.drawWorldMap = function() {
                            const result = originalDrawWorldMap.apply(this, arguments);
                            
                            // 向所有国家添加事件处理
                            this.mapG.selectAll(".country")
                                .on("mouseover", function(event, d) {
                                    // 调用原有tooltip处理 + 自定义tooltip
                                    window.myCustomTooltip.show(event, d);
                                    
                                    d3.select(this)
                                        .attr("stroke", "black")
                                        .attr("stroke-width", 2);
                                })
                                .on("mousemove", function(event) {
                                    window.myCustomTooltip.move(event);
                                })
                                .on("mouseout", function() {
                                    window.myCustomTooltip.hide();
                                    
                                    d3.select(this)
                                        .attr("stroke", "white")
                                        .attr("stroke-width", 0.5);
                                })
                                .on("click", function(event, d) {
                                    // 点击时也显示tooltip，但持续时间更长
                                    window.myCustomTooltip.show(event, d);
                                    
                                    // 高亮当前国家
                                    d3.select(this)
                                        .attr("stroke", "black")
                                        .attr("stroke-width", 2);
                                });
                            
                            return result;
                        };
                    }
                }
                
                // 加载globalCarbon.js文件
                const script = document.createElement('script');
                script.src = './js/globalCarbon.js';
                script.onload = function() {
                    // 修改GlobalViz原型中的方法
                    patchGlobalViz();
                    
                    // 创建GlobalViz实例
                    const viz = new GlobalViz('map');
                    // 加载数据并初始化可视化
                    viz.loadData();
                };
                document.body.appendChild(script);
            });
        </script>


        <script>
            document.addEventListener('DOMContentLoaded', () => {
            const sections = Array.from(document.querySelectorAll("main > section"));
            let isScrolling = false;
        
            window.addEventListener("wheel", function (event) {
                if (isScrolling) return;
        
                const delta = event.deltaY;
                const currentScroll = window.scrollY;
                const currentIndex = sections.findIndex(sec => {
                const rect = sec.getBoundingClientRect();
                return rect.top <= 10 && rect.bottom >= window.innerHeight / 2;
                });
        
                let targetIndex = currentIndex;
        
                if (delta > 0 && currentIndex < sections.length - 1) {
                targetIndex = currentIndex + 1;
                } else if (delta < 0 && currentIndex > 0) {
                targetIndex = currentIndex - 1;
                }
        
                if (targetIndex !== currentIndex) {
                isScrolling = true;
                sections[targetIndex].scrollIntoView({ behavior: "smooth" });
                setTimeout(() => { isScrolling = false; }, 1000); // prevent over-triggering
                }
            });
            });
        </script>







        <script>
        
            d3.csv("data/historical_emissions/GHG_emissions_source.csv").then(data => {
                const years = data.columns.slice(3); // Skip ISO, Sector, Gas
                let allData = {};

                // 整理成 allData[year] 結構
                years.forEach(year => {
                    const sectorSums = d3.rollup(
                        data,
                        v => d3.sum(v, d => +d[year]),
                        d => d.Sector
                    );
                    allData[year] = Array.from(sectorSums, ([label, value]) => ({ label, value }));
                });

                // 初始圖表設定
                const width = 500, height = 500, radius = Math.min(width, height) / 2;
                const svg = d3.select("#pie-chart")
                    .append("svg")
                    .attr("width", width)
                    .attr("height", height + 100) // 預留空間給 slider
                    .append("g")
                    .attr("transform", `translate(${width / 2}, ${height / 2})`);

                const arc = d3.arc()
                    .innerRadius(radius * 0.5)
                    .outerRadius(radius - 10);

                const outerArc = d3.arc()
                    .innerRadius(radius * 0.9)
                    .outerRadius(radius * 0.9);

                const pie = d3.pie()
                    .value(d => d.value)
                    .sort(null);

                const color = d => d.label === "Transportation" ? "#e74c3c" : "#3498db";

                const tooltip = d3.select("body").append("div")
                    .attr("class", "custom-tooltip")
                    .style("position", "absolute")
                    .style("padding", "8px")
                    .style("background", "#fff")
                    .style("border", "1px solid #aaa")
                    .style("border-radius", "5px")
                    .style("opacity", 0)
                    .style("pointer-events", "none");

                function midAngle(d) {
                    return d.startAngle + (d.endAngle - d.startAngle) / 2;
                }

                function updateChart(data) {
                    const pieData = pie(data);

                    // 圓餅
                    const paths = svg.selectAll("path").data(pieData, d => d.data.label);
                    paths.enter()
                        .append("path")
                        .attr("fill", d => color(d.data))
                        .attr("d", arc)
                        .each(function(d) { this._current = d; })
                        .merge(paths)
                        .transition().duration(750)
                        .attrTween("d", function(d) {
                            const interpolate = d3.interpolate(this._current, d);
                            this._current = interpolate(0);
                            return t => arc(interpolate(t));
                        });
                    paths.exit().remove();

                    // Tooltip
                    svg.selectAll("path")
                        .on("mouseover", (event, d) => {
                            tooltip.transition().duration(200).style("opacity", 0.9);
                            tooltip.html(`<strong>${d.data.label}</strong><br>${d.data.value.toLocaleString()} MtCO₂e`)
                                .style("left", (event.pageX + 10) + "px")
                                .style("top", (event.pageY - 20) + "px");
                        })
                        .on("mousemove", event => {
                            tooltip.style("left", (event.pageX + 10) + "px")
                                .style("top", (event.pageY - 20) + "px");
                        })
                        .on("mouseout", () => {
                            tooltip.transition().duration(300).style("opacity", 0);
                        });

                    // Labels
                    const texts = svg.selectAll("text").data(pieData, d => d.data.label);
                    texts.enter()
                        .append("text")
                        .text(d => d.data.label)
                        .attr("dy", "0.35em")
                        .merge(texts)
                        .transition().duration(750)
                        .attr("transform", d => {
                            const pos = outerArc.centroid(d);
                            pos[0] = radius * (midAngle(d) < Math.PI ? 1 : -1);
                            return `translate(${pos})`;
                        })
                        .style("text-anchor", d => midAngle(d) < Math.PI ? "start" : "end")
                        .style("font-size", "12px")
                        .style("fill", "#333");
                    texts.exit().remove();

                    // Lines
                    const lines = svg.selectAll("polyline").data(pieData, d => d.data.label);
                    lines.enter().append("polyline")
                        .merge(lines)
                        .transition().duration(750)
                        .attr("points", d => {
                            const posA = arc.centroid(d);
                            const posB = outerArc.centroid(d);
                            const posC = outerArc.centroid(d);
                            posC[0] = radius * 0.95 * (midAngle(d) < Math.PI ? 1 : -1);
                            return [posA, posB, posC];
                        })
                        .style("fill", "none")
                        .style("stroke", "#999")
                        .style("stroke-width", 1)
                        .style("opacity", 0.6);
                    lines.exit().remove();
                }

                // 初始圖表
                updateChart(allData["2022"]);

                // Slider 初始化
                const slider = d3.sliderBottom()
                    .min(d3.min(years, d => +d))
                    .max(d3.max(years, d => +d))
                    .step(1)
                    .width(400)
                    .ticks(5)
                    .default(2022)
                    .on('onchange', val => {
                        updateChart(allData[String(val)]);
                    });

                const gSlider = d3.select("#slider")
                    .append("svg")
                    .attr("width", 500)
                    .attr("height", 70)
                    .append("g")
                    .attr("transform", "translate(30,30)");

                gSlider.call(slider);
            });
        </script>

    </body>
</html>